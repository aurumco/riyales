<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- <link rel="manifest" href="manifest.json"> -->
  <!-- Theme colors for browser and PWA status bars -->
  <meta name="theme-color" content="#090909">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="msapplication-navbutton-color" content="#090909">
  <meta name="keywords" content="Riyales, currency, gold, crypto, stock, market, tracker, dollar, euro, riyal, دلار, یورو, ریال, پوند, لیر, روبل, قیمت, نرخ, طلا, بهار آزادی, سکه, سکه امامی, کریپتو, ارز دیجیتال, بیتکوین, اتریوم, تتر, ترون, 24 عیار, 18 عیار, عیار, بانک مرکزی, نرخ دلار, قیمت دلار, قیمت سکه, قیمت لحظه‌ای, نرخ بروز, بورس, سهام, شاخص بورس, شاخص فرابورس, تسهیلات مسکن, اوراق بدهی, ارز, درهم, دینار, ریالس, فرابورس, بورس اوراق بهادار, بورس اوراق بهادار تهران, قیمت دلار, نیمایی, بانکی, فیات, دلار چند, طلا چند, سکه چند, دلار آمریکا, تومان, قیمت هر دلار, سکه یک گرمی, نفت, نفت برنت, نفت اپک, گاز, قیمت نفت, قیمت گاز, فلزات, فلزات گرانبها, نقره, لیر ترکیه, روبل روسیه, دلار کانادا, پوند انگلیس, آخرین قیمت"
  <meta name="robots" content="index, follow">
  <meta name="author" content="Aurum">

  <meta name="description" content="Riyales – Currency, Gold, Crypto & Stock Prices">

  <!-- PWA & status bar styles -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Riyales">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Riyales</title>
  <!-- Open Graph for social sharing -->
  <meta property="og:title" content="Riyales">
  <meta property="og:description" content="Real-time currency, gold, crypto & stock prices">
  <meta property="og:image" content="icons/Icon-maskable-192.png">
  <meta property="og:url" content="https://ryls.ir">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Riyales">
  <meta name="twitter:description" content="Real-time currency, gold, crypto & stock prices">
  <meta name="twitter:image" content="icons/Icon-maskable-192.png">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json" id="structured-data">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "ریالِس",
    "url": "https://ryls.ir",
    "logo": "https://ryls.ir/assets/Icon-512.png",
    "description": "مرجع قیمت لحظه‌ای ارز، طلا و ارزهای دیجیتال",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://ryls.ir/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "mainEntityOfPage": {
       "@type":"WebPage",
       "@id":"https://ryls.ir"
    }
  }
  </script>

  <!-- Force HTML renderer to avoid GPU memory issues with CanvasKit -->
  <meta name="flutter-renderer" content="html" />

  <style>
    :root {
      --scrollbar-track-light: #f1f1f1;
      --scrollbar-thumb-light: rgba(0,0,0,0.4);
      --scrollbar-track-dark: #2C2C2E;
      --scrollbar-thumb-dark: rgba(255,255,255,0.4);
    }
    html, body {
      margin: 0;
      padding: constant(safe-area-inset-top) constant(safe-area-inset-right) constant(safe-area-inset-bottom) constant(safe-area-inset-left);
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      scroll-behavior: smooth;
      overflow: hidden;
    }
    .flutter-scrollbar::-webkit-scrollbar { width: 10px; display: none; }
    .flutter-scrollbar:hover::-webkit-scrollbar, 
    .flutter-scrollbar:active::-webkit-scrollbar, 
    .flutter-scrollbar:focus::-webkit-scrollbar { display: block; }
    .flutter-scrollbar::-webkit-scrollbar-track { background: var(--scrollbar-track-light); border-radius: 10px; }
    .flutter-scrollbar::-webkit-scrollbar-thumb { background-color: var(--scrollbar-thumb-light); border-radius: 5px; border: 2px solid var(--scrollbar-track-light); }
    .flutter-scrollbar { scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb-light) var(--scrollbar-track-light); }
    @media (prefers-color-scheme: dark) {
      .flutter-scrollbar::-webkit-scrollbar-track { background: var(--scrollbar-track-dark); }
      .flutter-scrollbar::-webkit-scrollbar-thumb { background-color: var(--scrollbar-thumb-dark); border: 2px solid var(--scrollbar-track-dark); }
      .flutter-scrollbar { scrollbar-color: var(--scrollbar-thumb-dark) var(--scrollbar-track-dark); }
    }
  </style>

</head>
<body style="background-color: #090909;">
  
  <script>
    (function() {
      "use strict";
      
      const API_URL = "https://raw.githubusercontent.com/aurumco/riyales-api/refs/heads/main/api/v1/market/lite.json";
      const ASSET_NAMES = {
        currency: ["دلار", "یورو", "لیر ترکیه", "روبل روسیه", "درهم امارات", "یوآن چین", "پوند", "دلار کانادا", "دینار کویت", "ریال عربستان", "دینار عراق", "دینار بحرین", "بات تایلند", "ریال عمان"],
        cryptocurrency: ["تتر", "بیت‌کوین", "اتریوم", "ترون", "دوج‌کوین", "بایننس کوین"],
        gold: ["سکه امامی", "سکه بهار آزادی", "سکه یک گرمی", "طلای ۱۸ عیار", "طلای ۲۴ عیار"]
      };

      function formatPrice(price, unit = 'تومان') {
        const num = Number(price);
        if (isNaN(num)) return price;
        return new Intl.NumberFormat('fa-IR').format(num) + (unit ? ' ' + unit : '');
      }

      function findAsset(data, type, name) {
        const list = data[type] || [];
        const nameKey = type === 'cryptocurrency' ? 'name_fa' : 'name';
        return list.find(item => item[nameKey] === name);
      }

      async function updateMetaWithLiveData() {
        try {
          const response = await fetch(API_URL, { headers: { 'Accept': 'application/json' } });
          if (!response.ok) return;

          const data = await response.json();
          let descriptionParts = [];
          
          const usd = findAsset(data, 'currency', 'دلار');

          // Detect language for title
          const lang = document.documentElement.lang || navigator.language || 'fa-IR';
          const isFa = lang.startsWith('fa');
          if (usd) {
            const price = formatPrice(usd.price, ''); // No unit for title
            const title = isFa
              ? `ریالِس، مرجع قیمت ارز و طلا | قیمت دلار ${price} تومان`
              : `Riyales | Dollar price ${price} Toman`;
            document.title = title;
            document.querySelector('meta[property="og:title"]').setAttribute('content', title);
            document.querySelector('meta[name="twitter:title"]').setAttribute('content', title);
          }
          
          // Description update
          const allAssets = [
            ...ASSET_NAMES.currency.map(name => findAsset(data, 'currency', name)),
            ...ASSET_NAMES.cryptocurrency.map(name => findAsset(data, 'cryptocurrency', name)),
            ...ASSET_NAMES.gold.map(name => findAsset(data, 'gold', name))
          ].filter(Boolean); // Filter out any assets that weren't found

          if (allAssets.length > 0) {
            const descriptionText = "قیمت لحظه‌ای: " + allAssets.map(asset => {
              const priceKey = asset.price_toman ? 'price_toman' : 'price';
              const name = asset.name_fa || asset.name;
              return `${name} ${formatPrice(asset[priceKey], asset.unit || '')}`;
            }).join('، ') + ". با ریالِس از آخرین تحولات بازار ارز، طلا و رمزارز باخبر شوید.";

            document.querySelector('meta[name="description"]').setAttribute('content', descriptionText);
            document.querySelector('meta[property="og:description"]').setAttribute('content', descriptionText);
            document.querySelector('meta[name="twitter:description"]').setAttribute('content', descriptionText);
          }

        } catch (error) {
          console.error("SEO Meta Updater: Failed to fetch or process live data.", error);
        }
      }

      updateMetaWithLiveData();
      // Periodically update the data every 5 minutes
      setInterval(updateMetaWithLiveData, 5 * 60 * 1000);

    })();
  </script>

  <script src="flutter_bootstrap.js" async></script>
  
</body>
</html>
